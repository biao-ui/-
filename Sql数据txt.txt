-- 创建数据库 BookstoreDB
CREATE DATABASE BookstoreDB;
GO

-- 使用数据库 BookstoreDB
USE BookstoreDB;
GO

-- 创建用户表 Users
CREATE TABLE Users (
    UserID INT IDENTITY(1,1) -- 用户ID，自增，主键
        PRIMARY KEY,
    Username VARCHAR(50) -- 用户名，唯一，非空
        UNIQUE NOT NULL,
    Password VARCHAR(255) -- 密码，非空
        NOT NULL,
    Email VARCHAR(100) -- 邮箱，唯一，非空
        UNIQUE NOT NULL,
    FullName VARCHAR(100), -- 全名
    ContactNumber VARCHAR(20), -- 联系电话
    ShippingAddress TEXT, -- 送货地址
    AvatarURL VARCHAR(255) -- 头像URL
);
GO

-- 创建图书分类表 Categories
CREATE TABLE Categories (
    CategoryID INT IDENTITY(1,1) -- 分类ID，自增，主键
        PRIMARY KEY,
    CategoryName VARCHAR(50) NOT NULL -- 分类名称，非空
);
GO

-- 创建图书表 Books
CREATE TABLE Books (
    BookID INT IDENTITY(1,1) -- 图书ID，自增，主键
        PRIMARY KEY,
    Title VARCHAR(100) NOT NULL, -- 书名，非空
    Author VARCHAR(100) NOT NULL, -- 作者，非空
    Publisher VARCHAR(100), -- 出版社
    Price DECIMAL(10, 2) NOT NULL, -- 价格，非空
    CoverImageURL VARCHAR(255), -- 封面图片URL
    Stock INT NOT NULL, -- 库存，非空
    Description TEXT, -- 描述
    CategoryID INT -- 分类ID，外键，关联分类表
        FOREIGN KEY REFERENCES Categories(CategoryID)
);
GO

-- 创建购物车表 Cart
CREATE TABLE Cart (
    CartID INT IDENTITY(1,1) -- 购物车ID，自增，主键
        PRIMARY KEY,
    UserID INT, -- 用户ID，外键，关联用户表
    BookID INT, -- 图书ID，外键，关联图书表
    Quantity INT NOT NULL -- 数量，非空
        FOREIGN KEY (UserID) REFERENCES Users(UserID),
        FOREIGN KEY (BookID) REFERENCES Books(BookID)
);
GO

-- 创建订单表 Orders
CREATE TABLE Orders (
    OrderID INT IDENTITY(1,1) -- 订单ID，自增，主键
        PRIMARY KEY,
    UserID INT, -- 用户ID，外键，关联用户表
    OrderStatus VARCHAR(50) NOT NULL, -- 订单状态，非空
    TotalAmount DECIMAL(10, 2) NOT NULL, -- 总金额，非空
    PaymentMethod VARCHAR(50), -- 支付方式
    PaymentStatus VARCHAR(50), -- 支付状态
    CreationTime DATETIME NOT NULL, -- 创建时间，非空
    UpdateTime DATETIME, -- 更新时间
    FOREIGN KEY (UserID) REFERENCES Users(UserID)
);
GO

-- 创建订单详情表 OrderDetails
CREATE TABLE OrderDetails (
    OrderDetailID INT IDENTITY(1,1) -- 订单详情ID，自增，主键
        PRIMARY KEY,
    OrderID INT, -- 订单ID，外键，关联订单表
    BookID INT, -- 图书ID，外键，关联图书表
    Quantity INT NOT NULL, -- 数量，非空
    UnitPrice DECIMAL(10, 2) NOT NULL, -- 单价，非空
    FOREIGN KEY (OrderID) REFERENCES Orders(OrderID),
    FOREIGN KEY (BookID) REFERENCES Books(BookID)
);
GO

-- 创建管理员表 Admins
CREATE TABLE Admins (
    AdminID INT IDENTITY(1,1) -- 管理员ID，自增，主键
        PRIMARY KEY,
    Username VARCHAR(50) UNIQUE NOT NULL, -- 用户名，唯一，非空
    Password VARCHAR(255) NOT NULL -- 密码，非空
);
GO

-- 创建用户反馈表 Feedback
CREATE TABLE Feedback (
    FeedbackID INT IDENTITY(1,1) -- 反馈ID，自增，主键
        PRIMARY KEY,
    UserID INT, -- 用户ID，外键，关联用户表
    FeedbackContent TEXT NOT NULL, -- 反馈内容，非空
    CreationTime DATETIME NOT NULL, -- 创建时间，非空
    FOREIGN KEY (UserID) REFERENCES Users(UserID)
);
GO